lock_screen_timer() {
  # Check if --test flag is passed
  if [ "$1" = "--test" ]; then
    osascript -e 'display notification "Testing lock screen timer" with title "Test"'
    sleep 3
    pmset displaysleepnow
    return
  fi

  # Default to 25 minutes if no argument is provided
  local minutes=${1:-25}
  local remaining_minutes=$minutes
  local total_blocks=20
  local filled_char="█"
  local empty_char="░"

  while [ $remaining_minutes -gt 0 ]; do
    # Calculate progress bar
    local filled_blocks=$(((remaining_minutes * total_blocks) / minutes))
    local empty_blocks=$((total_blocks - filled_blocks))
    local progress_bar=""

    # Build progress bar string
    for ((i = 0; i < filled_blocks; i++)); do
      progress_bar+=$filled_char
    done
    for ((i = 0; i < empty_blocks; i++)); do
      progress_bar+=$empty_char
    done

    # Clear previous line and show progress
    echo -ne "\r\033[K"
    if [ $remaining_minutes -eq 1 ]; then
      echo -ne "⏰ $progress_bar 1 minute remaining!"
      osascript -e 'display notification "Your screen will lock in 1 minute! ⚠️" with title "Warning"'
    else
      echo -ne "⏰ $progress_bar $remaining_minutes minutes remaining"
    fi

    sleep 60
    remaining_minutes=$((remaining_minutes - 1))
  done
  echo # Add newline at end

  # Lock the screen
  pmset displaysleepnow
}
