##############################################################
# Dev Utils
##############################################################

format() {
  echo "ğŸ’… Formatting files with Prettier...";
  npx prettier --write --loglevel=error .;
  echo "âœ… Done formatting";
}
lint() {
  echo "ğŸ” Linting files with ESLint...";
  npx eslint . --ext js,jsx,ts,tsx;
  echo "âœ… Done linting";
}
tc() {
  echo "ğŸ§ Type-checking files with TypeScript...";
  npx tsc --noEmit;
  echo "âœ… Done type-checking";
}
jest() {
  echo "ğŸ§ª Testing files changed on branch...";
  npx jest --changedSince=$(git_dev_branch) --coverage=false;
  echo "âœ… Done testing";
}
jestw() {
  echo "ğŸ§ªğŸ‘€ Testing files changed on branch on watch...";
  npx jest --changedSince=$(git_dev_branch) --watch --coverage=false;
  echo "âœ… Done testing";
}
jesta() {
  echo "ğŸ§ª Testing all files...";
  npx jest --coverage=false;
  echo "âœ… Done testing";
}
alias va='tc && test && lint && format'
alias vs='tc && lint && format'

##############################################################
# Git
##############################################################

# "git checkout branch"
alias gcob="git co -b"

# "git commit message" (oh-my-zsh originally has this as "git checkout master", but this makes more sense to me)
alias gcm="gc -m"

# "git pull origin main"
alias gpom="git pull origin \$(git_dev_branch)"

# Git diffing with origin/master and origin/<dev_branch>
alias gr="git rev"
alias grem="git remote" # (original oh-my-zsh `gr` alias)

# "git diff origin dev"
alias gdod="git fetch && git diff origin/\$(git_dev_branch)"
# "git diff origin main"
alias gdom="git fetch && git diff origin/\$(git_main_branch)"

# "git undo": "undoes" the last commit, and puts its changes back into the index
alias gundo="git reset HEAD~"
# "git undo soft/staged": "undoes" the last commit, and puts its changes into the staging area
alias gundos="git reset HEAD~ --soft"

# "git abandon": See .gitconfig alias for details
alias gab="git abandon"

# "git branch modify": Rename a branch
alias gbm="git branch -m"

git_dev_branch() {
  if [[ -n $(git branch --list develop) ]]; then 
    echo develop; 
  else 
    echo master; 
  fi 
}

##############################################################
# npm
##############################################################

alias ni="npm install"
alias nid="npm install -D"
alias nip="npm install -P"

##############################################################
# Miscellaneous
##############################################################

# Open fzf files with vim by default
alias goto="vim -o \`fzf\`"
# Make sure dotfiles are shown by ls
alias ls="ls -A"
# List directories
alias lsd="ls -d */"
# Log ip to console
alias myip="curl http://ipecho.net/plain; echo"
# Change ping to stop after 5 pings
alias ping="ping -c 5"
alias c="clear"
# I do these all the time when I'm mucking around with zsh/my .zshrc
alias ez="exec zsh"
alias sz="source ~/.zshrc"

# Clears the screen and runs the succeeding command(s)
run() {
  clear;
  eval $@;
}
